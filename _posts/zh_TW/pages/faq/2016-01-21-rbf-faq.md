---
### 來源於 https://www.reddit.com/r/Bitcoin/comments/3urm8o/optin_rbf_is_misunderstood_ask_questions_about_it/
title: 選擇性加入費用替代法（Opt-in RBF）常見問答
name: optin-rbf-faq
type: pages
layout: page
lang: zh_TW
permalink: /zh_TW/faq/optin_rbf/
version: 1
---
{% include toc.html %}

## 什麼是選擇性加入費用替代法？

選擇性加入費用替代法（opt-in RBF）讓交易被標記為可替換的，直到在區塊中被確認。

## 是新的特性嗎？

交易替換是由中本聰在第一次發布比特幣軟體時提出的，但之後由於拒絕服務而移除。選擇性加入費用替換法（opt-in RBF）透過要求付更高的手續費來替換交易，解決了此問題。

## 它有什麼用處？

在交易等待確認期間，一些錢包為了增加交易手續費（可能可以幫助更快被確認），希望可以更新這些交易，將多個交易壓縮到一個，創建交易輸入聯結（以提升隱私性），或執行許多其他有用的操作。

## 它是怎樣運作的？

選擇性加入費用替換法是對於記憶體池和傳播網路的一個改變，允許這些錢包在交易上選擇性添加標記，來告知全節點這些特殊的交易可能會被更新（替代），直到在新的區塊中被確認。

## 選擇性加入費用替代法的執行會改變“非費用替代法”交易會被雙花的可能性嗎？

不.為了讓選擇性加入費用替代法啟作用，需要被替換的交易必須標記為可替換（序號*小於* 最大值*-1*)

## 選擇性加入費用替代法會讓騙人的支付情況更容易成功嗎？

選擇性加入費用替代法對那些不使用它和已確認的交易沒有影響，也不會強制使用它。這意味著，擔心未確認交易的用戶，可以繼續不使用加費用替代法。

## 選擇性加入費用替代法本身會成為騙子的專用工具嗎，假設人們接受未完成確認的交易？

目前，我們還沒有理由相信他們，至少這種行為還不夠明顯。防止騙子使用已知的最有效的工具和做法。但是，如果他們（或直到更明確表示他們不是）接受者可以保護他們自己的資產，通過持續關注交易發非最大序號與非最大序號直到完成的方式，在此之前都是不安全的。

因為使用選擇性加入費用替代法，可以幫助這些花更多費用的人，減少確認交易的等待時間，哪怕有許多交易還在等待確認。這不是強人所難地去要求需要接受這項服務才能讓他們的交易完成確認。

## 為什麼未完成確認的交易是不安全？

比特幣交易是通過不同的分布系統，在這個系統中不是所有人都可以獲得最快的速度。什麼Alice看到的第一，Bob可能會看到第二個。比特幣的設計不提供Alice和Bob的機制來哪個這些交易中真的來了第一份協議;他們所能做的就是等待，看看有哪些交易在最佳塊鏈的有效塊被證實。

如今很取巧的雙花攻擊者們使用的工具來連接網路，通過正常地查詢衝突的支付交易，看到是在哪種版本在哪些商家以及哪個塊出現。這種手法可以讓他們的一筆交易變成兩筆，其中一個他們發給他們的受害者，另外一個他們發送給礦工進行確認的兩個版本。

不可替換性地支付給商家的存在阻止了他從節點了解雙花，直到它透過只是被挖掘他們第一次看到的東西礦工開採塊顯示出來。這種簡單的，常見的模式，有時進一步由其它技術擴增，例如使用未確認交易鏈，低的費用，或非標準的交易。

其結果是，絕大多數的安全性未確認的交易不是來自比特幣系統內部，而是來自外部因素，如大多說誠實的比特幣用戶從來沒有試圖騙取他們的供應商，對於少量供應商之間的被寬容的欺詐，銷售商進行訴諸法律體系或其他類型的追索，並對比特幣協議的設計沒辦法做什麼（或威脅）。

所有這些事情對於選擇性加入費用替代法都是同樣真實的（就像在美國使用信用卡支付，幾個月之前的交易很容易可以取消而讓欺詐率變得更低，幾乎所有重要的商人都接受）。同時，由於選擇性加入費用替代法可以可以消除長網路延遲確認，一些商家不再需要像之前那樣為減少欺詐風險，而被迫接受確認的交易以避免延誤。

然而，沒有人採用選擇性加入費用替代法堅持認為你同意以上針對未確認交易安全的觀點。選擇性加入費用替代法是可選擇性的，而且如果你不需要他，你完全可以不採用。

## 是誰發明了未確認交易的替換？這與比特幣的“願景”相衝突嗎？

未確認交易的替換曾是“比特幣發行之初的特點”(https://github.com/trottier/original-bitcoin/blob/master/src/main.cpp#L434)，在設置了非最大序號後，交易可將自己標記為可替換。之後，這項功能被廢止了，因為有可能攻擊者會用盡全節點間的所有頻寬以引起拒絕服務的易損性，而對其自身的代價卻很小。

此外，沒有激勵措施來使礦工遵循談話並且接受替換，甚至還有可能因為一個更早版本的交易支付了更高的交易費而導致對談話的違反。

這兩個因素不斷被更換被恢復持續了好幾年，但在2013年Peter Todd[建議](https://bitcointalk.org/index.php?topic=199947.0) 要求支付嚴格大於費用率的替換措施以及要求這項替換由增加一個最小交易費來生成交易來增加交易費率。這就同時消除了拒絕服務和激勵相容的問題。

Peter最初的工作走的更遠並且邏輯上導致了包含激勵相容。因為在匿名、瞬息、自選擇的礦工面前，只有對高額交易的可選擇能指望。對高額交易費的傾向能夠使節點在基於交易費比率的記憶體池中包含完整交易的集合成為可能，這對於只接受前一個版本的交易的節點來說並不可能。

因為以上的原因並且因為系統在可預期的方式中運作比在“不可預期但是在平均水平上更好”上運行更加的安全和可保護。他提議交易的替換在所有交易上都可發生，他同時提議一個以強激勵相容的方式去除所有從雙重花費中取得經濟所得的協議，稱為替換焦土：當有人試圖對你雙重花費，你可以把所有的錢當做交易費來防止攻擊者得到。（但這是一個只有理論遊戲者會喜歡的提議）

在Peter的建議之後，我們已經收到來自像[Greenaddress](https://blog.greenaddress.it/2015/12/09/why-replace-by-fee-is-good-for-bitcoin/) 這樣的錢包強烈地請求可選擇交易費替換。他們確實的需要一個合理的途徑來處理交易費，對交易費的可選擇就是一個更好地方式，這也是為什麼修改這項提議來符合中本聰最初的可選擇的行為。

## 選擇性加入手續費優先這個請求有爭議嗎？

並沒有。在上個月進行了廣泛的研討後，[PR][RBF PR]在10月22日開始實行。之後，至少在四次比特幣發展周會上也對此進行了討論。（[2015-11-05][], [2015-11-12][], [2015-11-19][], and [2015-11-26][]）

[RBF PR]: https://github.com/bitcoin/bitcoin/pull/6871
[2015-11-05]: /en/meetings/2015/11/05/
[2015-11-12]: /en/meetings/2015/11/12/
[2015-11-19]: /en/meetings/2015/11/19/
[2015-11-26]: /en/meetings/2015/11/26/

在PR討論中，有19人發表了評論（他們代表了至少三個不同的錢包品牌），並有14人明確地表達支持，其中至少有一人曾在過去非常公開地反對完全費用替代法（full RBF）。此次會議召開期間，沒有收到與會者（或是其它我們可了解的平台）對此項提案明確反對的回饋。

## 這些改變在何時會以何種方式啟動呢？

選擇性加入費用替代發（Opt-in RBF）代這一改變並沒有一個真正的啟動過程，因為這不是比特幣共識的一部分。這只是一個本地的政策行為，所以這些改變會在人們應用新版軟體的時候一次一個節點地發生。在網路上已經有有一段時間，可能按年計，有某些節點用各種方式實施了費用替代法（RBF）這一政策。

比特幣核心0.12版本會在2016年2月發布，並且包含選擇性加入費用替代法（opt-in RBF）這一政策。這之後在這一行為成為普遍之前可能會有幾個月的時間。這一過程也可能會因為相關的有趣應用的開發而加快速度

## 選擇性加入費用替代法（opt-in RBF）只在調整手續費上有用嗎？

不，另一個錢包可以做的是在第一交易還沒有確認之前將兩個交易轉換成一個交易。即使這種替換需要繳納比原先更高的交易費，這仍能節省很大一部分位元組和交易費。

選擇性加入費用替代法（Opt-in RBF）也可以用來實行更加先進的合作穩定策略，比如[直通式交易](https://bitcointalk.org/index.php?topic=281848.0)。

眾多[智慧合約](https://bitcointalk.org/index.php?topic=321228.0)也需要能夠替換，但它們在沒有替換機制的時候通常透過鎖定時間來創建更健壯的訂單和工作；這是被認為支持在比特幣原本的設計中加入替換機制的動機。

儘管在僅調整費率之外還有其他更有趣的原因，然而調整費率的能力不可因此被低估。這意味著初始費用可以使用“最有可能”預估中的最低價，而非超額支付來“以防萬一”。即使在替換交易鮮少出現的情況下，這也將導致較低的費用。

## 錢包需要保持在線以發布更高費率的替換交易嗎？

不，替換交易可以被預計算、時間鎖定並被傳至始終在線的遠程伺服器以備之後的廣播，且伺服器不存在可盜用用戶資金的風險。（最壞的情況就是廣播失敗）

例如，在第100個區塊上，一個錢包想進行一筆交易並在3個區塊中確認。在最佳預估了3個區塊確認需要的費用後，錢包會在第101個區塊上授權一筆交易。同時，它將在第104、105、106、107等等這些高度上授權鎖定了時間的替換交易。在此假設高度上，後者的費用是前者的1.5倍。這些都將被傳遞到一個接受以鎖定時間為交易優先順序的節點上。

儘管礦工們了解未來他們可以得到更高的費用，理性來講，他們仍更傾向於現在的方案。因為如果他們等待，就會有別的礦工來收取費用。這種按倍數增加的方式意味著最壞也不過是一筆交易可能被多付了50%，但是幾筆交易下來也可以隨機的達到高額的費用。

## 對交易費的可選擇會增加懶人式交易被欺騙的風險嗎？

看起來不是這樣，至少不會特別重要因為這是設計上所允許的。對交易費的可選擇利用nSequence域來標識，這個域只被用來標識可替換性。許多信任未確認交易的程序和平台總體上已經認為低序列的交易是可疑的並且忽視這些交易直到被確認。

現在有特別多的方式加快交易被確認的速度或者增加可靠度，以此增加成功進行雙重交易的機率

- 付更少的交易費
- 實用非標準的標識或者版本
- 花費未確認的輸入
- 行為符合任何一種拒絕式攻擊的特徵
- 創建不符合規範的交易
- 等等

這些判定標準會經常改變，並且取決於節點上用戶可配置的某些規則。對於有關方面來說，想要嘗試預測未確認的支付就需要追蹤所有的這些，甚至是更多，並且他們還要對改變做出前瞻性的回應。早在幾個月前，選擇性加入費用替代法（Opt-in RBF）這個提案就被添加進來並被廣泛探討交流，甚至蓋過了一些早就被檢測到的行為。如果說在未確認交易警戒上需要有任何努力上的改變，那就應該歸功於選擇性加入費用替代法。

更別說，對交易費的可選擇是否比非交易費可選擇的對於欺騙性雙重花費更有作用還是未知數，至少對於使用複雜工具的攻擊者來說是這樣的

有些施行未確認可信賴度分析的組織已經明確地表示它們[已經準備好了][blockcypher ready]， 如果有任何人意識到軟體仍然需要改變，告知我們我們很樂意來幫忙

[blockcypher ready]: https://twitter.com/BlockCypher/status/670334879565922304

## 如果我覺得交易費優先就是非常糟糕呢？

那就不要用它：不要在自己的交易上設置這一標記並且把所有你接收的序號小於MAX_INT-1的交易認為不存在（或者已經被雙重花費）直到交易被確認

沒有我們所知的常用的軟體把它的序號設置的比MAX_INT-1小，許多程序（包括“自信交易”）已經視低序號為可能被雙重花費的。畢竟被顯式地標記為可被替換的交易，即使沒有交易費優先，nLocktime仍可能導致交易確認的衝突。

如果有人發給你一個可被替換的交易並且你不想錯過，它的可替換性能使它被想被多快確認就被多快確認。現存的有些情況例如發送者使用非標準的交易特性或者花費未被確認的產出已經客觀上使得很多交易更加容易被雙重花費----更別說這些情況中還沒有能讓交易更快被確認的方法

交易費優先（RBF）是為滿足成人的一項特性。如果你不想加入它，你不需要加入。你對它的不喜歡不是防止其他使用它的人來進行無關你的交易的理由

## 為什麼是可選擇的而不是讓礦工可以替換任何交易？

現在沒有什麼能夠阻止礦工替換甚至是非可選擇的交易，並且有些礦工已經自己試驗過交易費優先策略。推出標準的相關應用可以滿足對這一特性的需求，這也有可能降低礦工替換任何高交易費交易的熱情。

## 我聽說選擇性加入費用替代法（RBF）很少或沒有被討論

最近的一次費用替代法（RBF）的討論要追溯到2015年5月。

Github:

添加先見安全費用替代法（replace-by-fee）邏輯到記憶體池 [#6176](https://github.com/bitcoin/bitcoin/pull/6176)
安排完全費用替代法（full-RBF）部署 [#6352](https://github.com/bitcoin/bitcoin/pull/6352)
基於序列完全費用替代法（Full-RBF opt-in） [#6871](https://github.com/bitcoin/bitcoin/pull/6871)

網際網路中繼聊天會議：

- [2015-11-05][]
- [2015-11-12][]
- [2015-11-19][]
- [2015-11-26][]

有許多其他日誌 [#bitcoin-dev](http://bitcoinstats.com/) and [#bitcoin-core-dev](https://botbot.me/freenode/bitcoin-core-dev/)。

郵件列表討論沒有特定順序。

- [[比特幣開發] 選擇性加入費用替代法（Full-RBF）](https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2015-November/011783.html)
- [[比特幣開發] 初見費用替代法 （First-Seen-Safe Replace-by-Fee）](http://lists.linuxfoundation.org/pipermail/bitcoin-dev/2015-May/008248.html)
- [[比特幣開發] 透過使用費用替代法（replace-by-fee）可節省成本, 30-90%](http://lists.linuxfoundation.org/pipermail/bitcoin-dev/2015-May/008232.html)
- [[比特幣開發] 重複發送未確認的交易將會導致重大損失](http://lists.linuxfoundation.org/pipermail/bitcoin-dev/2015-July/009420.html)
- [[比特幣開發] 比特幣價格指數: 完全費用替代法（Full Replace-by-Fee）部署安排](http://lists.linuxfoundation.org/pipermail/bitcoin-dev/2015-June/009253.html)
- [[比特幣開發] 費用替代法 （Replace-by-Fee） v0.10.0rc4] (http://lists.linuxfoundation.org/pipermail/bitcoin-dev/2015-February/007404.html)
- [[比特幣開發] 錢包是如何處理真正的交易手續費](https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2015-November/011685.html)

中本聰首次介紹 [未確認交易替換](https://github.com/trottier/original-bitcoin/blob/master/src/main.cpp#L434) 但是後因DOS攻擊被移除（Peter Todd通過對每個替代要求更高手續費的方式解決了該問題）。

##這可以用於對未採取措施的（舊）錢包進行雙花嗎？所有的錢包都要進行更新嗎？

無論有沒有費用優先發，未確認的交易永遠可以被雙花。騙局目前來說很容易，並且費用優先法也不能改變。

只有在如果他們想要使用選擇性加入費用替代法時，才必須更新錢包。這給了錢包一個可以創新並為用戶提供利益的新維度。

## 為什麼不使用先見安全-費用替代法（FSS-RBF）

FSS-RBF意味著交易只有在之前所有的支出都被花掉的情況下才能被修改，這樣就防止了重複交易，但其若被實行也將帶來三個問題。

1. 它導致交易增長，因為你必須添加新的輸入到每一個替代中。

2. 很多錢包沒有多餘的比特幣，所以他們不能使用FSS-RBF。

3. 它在幾乎是永遠提升支出改變的價值的同時降低了隱私性，因為對外來說支出被標記為改變。

## CPFP是什麼意思？

這是一種透過創建另一個基於第一個的交易來添加交易費的方式

## 為什麼不用CPFP來替代RBF？

CPFP並不會解決同樣的問題。RBF允許“消費者”增加手續費；CPFP是有用的因為它允許“接受者”增加交易費。

RBF比CPFP更有優勢在於它並不必須地需要使用另外的區塊空間，所以它大概增加[30%~90% 的效率](http://lists.linuxfoundation.org/pipermail/bitcoin-dev/2015-May/008232.html)。

計劃是同時支持CPFP和可選擇的RBF。
